export function ceil_log2 (pint a) : pint
{
  pint i;
  pint M;
  chp {
     i := 0;
     M := a-1;
    *[ M > 0 -> i := i + 1; M := M/2 ];
     self := i
  }
}

template<pint N>
function popcount (int<N> x) : int<ceil_log2(N)>
{
  int<1> a[N];
  chp {
   (,i:N:a[i] := x{i});
   self := (+ i : N : a[i])
   }
}

defproc test()
{
   int<2> x;
   chp {
    x := popcount<2>(x)
   }
}

test t;
